{"version":3,"names":["React","useState","useEffect","Button","Platform","ScrollView","StyleSheet","Dimensions","ActivityIndicator","Text","WebView","Camera","injectFirst","NativeWebView","source","style","optimizeVideoChat","otherWebViewProps","height","setHeight","cameraPermissions","setCameraPermissions","microphonePermissions","setMicrophonePermissions","videoChatProps","allowsInlineMediaPlayback","domStorageEnabled","javaScriptEnabled","mediaCapturePermissionGrantType","mediaPlaybackRequiresUserAction","startInLoadingState","onMessage","event","Number","nativeEvent","data","getAndSetPermissions","currentState","setCurrentState","getPermission","requestPermission","currentPermission","granted","canAskAgain","getAndSetCameraAndMicrophonePermissions","getCameraPermissionsAsync","requestCameraPermissionsAsync","getMicrophonePermissionsAsync","requestMicrophonePermissionsAsync","getFinalWidth","width","get","includes","replace","selectComponent","status","styles","container","BrowserWebView","frameBorder","allow","videoChatStyles","flatStyles","flatten","createElement","src","uri","srcDoc","html","allowFullScreen","seamless","select","native","default","create","flexGrow","alignItems","justifyContent"],"sources":["WebView.tsx"],"sourcesContent":["import React, {\n  useState,\n  useEffect,\n  Dispatch,\n  SetStateAction,\n  ReactElement,\n} from \"react\";\nimport {\n  Button,\n  Platform,\n  ScrollView,\n  StyleSheet,\n  ViewStyle,\n  Dimensions,\n  ActivityIndicator,\n  Text,\n} from \"react-native\";\nimport { WebView } from \"react-native-webview\";\nimport {\n  WebViewMessageEvent,\n  WebViewSourceHtml,\n  WebViewSourceUri,\n  WebViewNavigationEvent,\n  WebViewProgressEvent,\n  WebViewErrorEvent,\n  WebViewHttpErrorEvent,\n  WebViewNavigation,\n  WebViewScrollEvent,\n  WebViewTerminatedEvent,\n  ShouldStartLoadRequest,\n} from \"react-native-webview/lib/WebViewTypes\";\nimport { Camera, PermissionResponse } from \"expo-camera\";\n\n// Auto-height fix (if this is not present, scrolling on Android does not work)\nconst injectFirst = `\n  window.ReactNativeWebView.postMessage(\n    Math.max(document.body.offsetHeight, document.body.scrollHeight)\n  );\n`;\n\ninterface WebViewProps {\n  source: WebViewSourceUri | WebViewSourceHtml;\n  style?: ViewStyle;\n  optimizeVideoChat?: boolean;\n  // Advancted Builder Config Props\n  mediaPlaybackRequiresUserAction?: boolean;\n  startInLoadingState?: boolean;\n  javaScriptEnabled?: boolean;\n  javaScriptCanOpenWindowsAutomatically?: boolean;\n  showsHorizontalScrollIndicator?: boolean;\n  showsVerticalScrollIndicator?: boolean;\n  allowFileAccessFromFileURLs?: boolean;\n  allowUniversalAccessFromFileURLs?: boolean;\n  incognito?: boolean;\n  cacheEnabled?: boolean;\n  userAgent?: string;\n  applicationNameForUserAgent?: string;\n  // For Custom Code Only\n  // See https://github.com/react-native-webview/react-native-webview/blob/master/src/WebViewTypes.ts\n  injectedJavaScript?: string;\n  onError?: (event: WebViewErrorEvent) => void;\n  onLoad?: (event: WebViewNavigationEvent) => void;\n  onLoadEnd?: (event: WebViewNavigationEvent | WebViewErrorEvent) => void;\n  onLoadStart?: (event: WebViewNavigationEvent) => void;\n  onLoadProgress?: (event: WebViewProgressEvent) => void;\n  onHttpError?: (event: WebViewHttpErrorEvent) => void;\n  onMessage?: (event: WebViewMessageEvent) => void;\n  onNavigationStateChange?: (event: WebViewNavigation) => void;\n  onScroll?: (event: WebViewScrollEvent) => void;\n  onContentProcessDidTerminate?: (event: WebViewTerminatedEvent) => void;\n  onShouldStartLoadWithRequest?: (event: ShouldStartLoadRequest) => boolean;\n  originWhitelist?: string[];\n  renderLoading?: () => ReactElement;\n  renderError?: (\n    errorDomain: string | undefined,\n    errorCode: number,\n    errorDesc: string\n  ) => ReactElement; // view to show if there's an error\n  containerStyle?: ViewStyle;\n}\n\nconst NativeWebView: React.FC<WebViewProps> = ({\n  source,\n  style,\n  optimizeVideoChat,\n  ...otherWebViewProps\n}) => {\n  const [height, setHeight] = useState(0);\n\n  const [cameraPermissions, setCameraPermissions] =\n    useState<null | PermissionResponse>(null);\n\n  const [microphonePermissions, setMicrophonePermissions] =\n    useState<null | PermissionResponse>(null);\n\n  const videoChatProps = optimizeVideoChat\n    ? {\n        allowsInlineMediaPlayback: true,\n        domStorageEnabled: true,\n        javaScriptEnabled: true,\n        mediaCapturePermissionGrantType: \"grant\", // so iOS uses system settings\n        mediaPlaybackRequiresUserAction: false,\n        startInLoadingState: true,\n      }\n    : ({} as Record<string, boolean | string>);\n\n  const onMessage = (event: WebViewMessageEvent) =>\n    setHeight(Number(event.nativeEvent.data));\n\n  const getAndSetPermissions = async (\n    currentState: null | PermissionResponse,\n    setCurrentState: Dispatch<SetStateAction<null | PermissionResponse>>,\n    getPermission: () => Promise<PermissionResponse>,\n    requestPermission: () => Promise<PermissionResponse>\n  ) => {\n    const currentPermission = currentState ?? (await getPermission());\n\n    if (currentPermission.granted || !currentPermission.canAskAgain) {\n      setCurrentState(currentPermission);\n    } else {\n      setCurrentState(await requestPermission());\n    }\n  };\n\n  const getAndSetCameraAndMicrophonePermissions = async () => {\n    await getAndSetPermissions(\n      cameraPermissions,\n      setCameraPermissions,\n      Camera.getCameraPermissionsAsync,\n      Camera.requestCameraPermissionsAsync\n    );\n\n    await getAndSetPermissions(\n      microphonePermissions,\n      setMicrophonePermissions,\n      Camera.getMicrophonePermissionsAsync,\n      Camera.requestMicrophonePermissionsAsync\n    );\n  };\n\n  const getFinalWidth = () => {\n    const { width } = Dimensions.get(\"window\");\n\n    if (typeof style?.width === \"number\") {\n      return style.width;\n    } else if (typeof style?.width === \"string\" && style.width.includes(\"%\")) {\n      return width * (Number(style.width.replace(\"%\", \"\")) / 100);\n    } else {\n      return width;\n    }\n  };\n\n  const selectComponent = () => {\n    if (\n      !optimizeVideoChat ||\n      (cameraPermissions?.granted && microphonePermissions?.granted)\n    ) {\n      return (\n        <WebView\n          source={source}\n          style={{ ...style, width: getFinalWidth() }}\n          injectedJavaScript={injectFirst}\n          onMessage={onMessage}\n          {...otherWebViewProps}\n          {...videoChatProps}\n        />\n      );\n    }\n\n    if (\n      (!cameraPermissions?.granted && cameraPermissions?.canAskAgain) ||\n      (!microphonePermissions?.granted && microphonePermissions?.canAskAgain)\n    ) {\n      return (\n        <Button\n          title={\"Press to enable Audio and/or Video permissions\"}\n          onPress={getAndSetCameraAndMicrophonePermissions}\n        />\n      );\n    }\n\n    if (\n      (cameraPermissions?.status === \"denied\" &&\n        cameraPermissions?.canAskAgain === false) ||\n      (microphonePermissions?.status === \"denied\" &&\n        microphonePermissions?.canAskAgain === false)\n    ) {\n      return (\n        <Text>\n          {\"Set the missing Audio and/or Video permissions in System Settings\"}\n        </Text>\n      );\n    }\n\n    return <ActivityIndicator />;\n  };\n\n  useEffect(() => {\n    if (optimizeVideoChat) getAndSetCameraAndMicrophonePermissions();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [optimizeVideoChat]);\n\n  return (\n    <ScrollView\n      contentContainerStyle={[\n        styles.container,\n        {\n          height: style?.height || height,\n        },\n      ]}\n    >\n      {selectComponent()}\n    </ScrollView>\n  );\n};\n\nconst BrowserWebView: React.FC<WebViewProps> = ({\n  source,\n  style,\n  optimizeVideoChat,\n}) => {\n  const videoChatProps = optimizeVideoChat\n    ? {\n        frameBorder: \"0\",\n        allow: \"camera; microphone; fullscreen; speaker; display-capture\",\n      }\n    : {};\n\n  const videoChatStyles = optimizeVideoChat\n    ? { width: \"100%\", height: \"100%\" }\n    : {};\n\n  const flatStyles = StyleSheet.flatten([videoChatStyles, style]);\n  return React.createElement(\"iframe\", {\n    style: flatStyles,\n    height: flatStyles?.height,\n    width: flatStyles?.width,\n    src: (source as WebViewSourceUri)?.uri,\n    srcDoc: (source as WebViewSourceHtml)?.html,\n    allowFullScreen: true,\n    seamless: true,\n    ...videoChatProps,\n  });\n};\n\nexport default Platform.select({\n  native: NativeWebView,\n  default: BrowserWebView,\n});\n\nconst styles = StyleSheet.create({\n  container: {\n    flexGrow: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n});\n"],"mappings":"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"}