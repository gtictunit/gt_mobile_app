{"version":3,"names":["React","Text","View","StyleSheet","TouchableHighlight","Audio","AntDesign","Slider","formatDuration","duration","seconds","Math","floor","minutes","hours","renderedHours","renderedMinutes","renderedSeconds","AudioPlayer","source","sound","setSound","useState","playing","setPlay","loading","setLoading","durationMillis","setDurationMillis","isDraggingSlider","setIsDraggingSlider","sliderPositionMillis","setSliderPositionMillis","onPlaybackStatusUpdate","status","isLoaded","isPlaying","positionMillis","didJustFinish","undefined","unloadAsync","setOnPlaybackStatusUpdate","useEffect","loadAudio","s","Sound","createAsync","playAsync","playSound","pauseAsync","setTrackPosition","setPositionAsync","onSlidingComplete","sliderValue","onSliderChange","iconName","styles","container","marginRight","flex","create","backgroundColor","paddingHorizontal","paddingVertical","borderRadius","flexDirection","alignItems"],"sources":["AudioPlayer.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { Text, View, StyleSheet, TouchableHighlight } from \"react-native\";\nimport { Audio, AVPlaybackStatus, AVPlaybackSource } from \"expo-av\";\nimport { AntDesign } from \"@expo/vector-icons\";\nimport Slider from \"@react-native-community/slider\";\n\nimport type { Sound } from \"expo-av/build/Audio/Sound\";\n\nfunction formatDuration(duration: number) {\n  if (duration === 0 || duration === 1) return \"00:00\";\n\n  const seconds = Math.floor((duration / 1000) % 60);\n  const minutes = Math.floor((duration / (1000 * 60)) % 60);\n  const hours = Math.floor((duration / (1000 * 60 * 60)) % 24);\n\n  const renderedHours = hours < 10 ? \"0\" + hours : hours;\n  const renderedMinutes = minutes < 10 ? \"0\" + minutes : minutes;\n  const renderedSeconds = seconds < 10 ? \"0\" + seconds : seconds;\n\n  if (hours > 0) {\n    return renderedHours + \":\" + renderedMinutes + \":\" + renderedSeconds;\n  }\n\n  return renderedMinutes + \":\" + renderedSeconds;\n}\n\nexport default function AudioPlayer({ source }: { source: AVPlaybackSource }) {\n  const [sound, setSound] = React.useState<Sound>();\n  const [playing, setPlay] = React.useState(false);\n  const [loading, setLoading] = React.useState(false);\n  const [durationMillis, setDurationMillis] = React.useState(1);\n  const [isDraggingSlider, setIsDraggingSlider] = React.useState(false);\n  const [sliderPositionMillis, setSliderPositionMillis] = React.useState(0);\n\n  const onPlaybackStatusUpdate = async (status: AVPlaybackStatus) => {\n    if (status.isLoaded) {\n      if (status.isPlaying && !isDraggingSlider) {\n        setSliderPositionMillis(status.positionMillis);\n      }\n\n      if (status.didJustFinish) {\n        setSound(undefined);\n        setPlay(false);\n        setSliderPositionMillis(0);\n\n        if (sound) {\n          await sound.unloadAsync();\n        }\n      }\n    }\n  };\n\n  const setOnPlaybackStatusUpdate = () => {\n    if (sound) {\n      sound.setOnPlaybackStatusUpdate(onPlaybackStatusUpdate);\n    }\n  };\n\n  React.useEffect(() => {\n    return sound\n      ? () => {\n          sound.unloadAsync();\n        }\n      : undefined;\n  }, [sound]);\n\n  async function loadAudio() {\n    setLoading(true);\n\n    const { sound: s, status } = await Audio.Sound.createAsync(source);\n    setSound(s);\n    setLoading(false);\n    setOnPlaybackStatusUpdate();\n\n    if (status.isLoaded && status.durationMillis) {\n      setDurationMillis(status.durationMillis);\n    }\n\n    s.setOnPlaybackStatusUpdate(onPlaybackStatusUpdate);\n\n    await s.playAsync();\n    setPlay(true);\n  }\n\n  async function playSound() {\n    if (sound && playing) {\n      await sound.pauseAsync();\n      setPlay(false);\n      return;\n    }\n\n    if (sound && !playing) {\n      await sound.playAsync();\n      setPlay(true);\n      return;\n    }\n\n    await loadAudio();\n  }\n\n  const setTrackPosition = async (positionMillis: number) => {\n    if (sound) {\n      await sound.setPositionAsync(positionMillis);\n    }\n  };\n\n  const onSlidingComplete = (sliderValue: number) => {\n    if (isDraggingSlider) {\n      setIsDraggingSlider(false);\n    }\n    setTrackPosition(sliderValue);\n  };\n\n  const onSliderChange = () => {\n    if (!isDraggingSlider) {\n      setIsDraggingSlider(true);\n    }\n  };\n\n  const iconName = loading ? \"loading1\" : !sound || !playing ? \"play\" : \"pause\";\n\n  return (\n    <View style={styles.container}>\n      <TouchableHighlight onPress={playSound} style={{ marginRight: 8 }}>\n        <AntDesign name={iconName} size={24} />\n      </TouchableHighlight>\n      <Text style={{ marginRight: 8 }}>\n        {formatDuration(sliderPositionMillis || 0)} /{\" \"}\n        {formatDuration(durationMillis || 0)}\n      </Text>\n      <Slider\n        style={{ flex: 1 }}\n        minimumTrackTintColor=\"#333\"\n        maximumTrackTintColor=\"#000000\"\n        thumbTintColor=\"black\"\n        minimumValue={0}\n        value={sliderPositionMillis}\n        maximumValue={durationMillis}\n        onValueChange={onSliderChange}\n        onSlidingComplete={onSlidingComplete}\n      />\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    backgroundColor: \"#eee\",\n    paddingHorizontal: 16,\n    paddingVertical: 8,\n    borderRadius: 24,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n});\n"],"mappings":"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"}