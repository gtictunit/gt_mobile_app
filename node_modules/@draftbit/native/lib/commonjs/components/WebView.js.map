{"version":3,"names":["injectFirst","NativeWebView","source","style","optimizeVideoChat","otherWebViewProps","height","setHeight","useState","cameraPermissions","setCameraPermissions","microphonePermissions","setMicrophonePermissions","videoChatProps","allowsInlineMediaPlayback","domStorageEnabled","javaScriptEnabled","mediaCapturePermissionGrantType","mediaPlaybackRequiresUserAction","startInLoadingState","onMessage","event","Number","nativeEvent","data","getAndSetPermissions","currentState","setCurrentState","getPermission","requestPermission","currentPermission","granted","canAskAgain","getAndSetCameraAndMicrophonePermissions","Camera","getCameraPermissionsAsync","requestCameraPermissionsAsync","getMicrophonePermissionsAsync","requestMicrophonePermissionsAsync","getFinalWidth","width","Dimensions","get","includes","replace","selectComponent","status","useEffect","styles","container","BrowserWebView","frameBorder","allow","videoChatStyles","flatStyles","StyleSheet","flatten","React","createElement","src","uri","srcDoc","html","allowFullScreen","seamless","Platform","select","native","default","create","flexGrow","alignItems","justifyContent"],"sources":["WebView.tsx"],"sourcesContent":["import React, {\n  useState,\n  useEffect,\n  Dispatch,\n  SetStateAction,\n  ReactElement,\n} from \"react\";\nimport {\n  Button,\n  Platform,\n  ScrollView,\n  StyleSheet,\n  ViewStyle,\n  Dimensions,\n  ActivityIndicator,\n  Text,\n} from \"react-native\";\nimport { WebView } from \"react-native-webview\";\nimport {\n  WebViewMessageEvent,\n  WebViewSourceHtml,\n  WebViewSourceUri,\n  WebViewNavigationEvent,\n  WebViewProgressEvent,\n  WebViewErrorEvent,\n  WebViewHttpErrorEvent,\n  WebViewNavigation,\n  WebViewScrollEvent,\n  WebViewTerminatedEvent,\n  ShouldStartLoadRequest,\n} from \"react-native-webview/lib/WebViewTypes\";\nimport { Camera, PermissionResponse } from \"expo-camera\";\n\n// Auto-height fix (if this is not present, scrolling on Android does not work)\nconst injectFirst = `\n  window.ReactNativeWebView.postMessage(\n    Math.max(document.body.offsetHeight, document.body.scrollHeight)\n  );\n`;\n\ninterface WebViewProps {\n  source: WebViewSourceUri | WebViewSourceHtml;\n  style?: ViewStyle;\n  optimizeVideoChat?: boolean;\n  // Advancted Builder Config Props\n  mediaPlaybackRequiresUserAction?: boolean;\n  startInLoadingState?: boolean;\n  javaScriptEnabled?: boolean;\n  javaScriptCanOpenWindowsAutomatically?: boolean;\n  showsHorizontalScrollIndicator?: boolean;\n  showsVerticalScrollIndicator?: boolean;\n  allowFileAccessFromFileURLs?: boolean;\n  allowUniversalAccessFromFileURLs?: boolean;\n  incognito?: boolean;\n  cacheEnabled?: boolean;\n  userAgent?: string;\n  applicationNameForUserAgent?: string;\n  // For Custom Code Only\n  // See https://github.com/react-native-webview/react-native-webview/blob/master/src/WebViewTypes.ts\n  injectedJavaScript?: string;\n  onError?: (event: WebViewErrorEvent) => void;\n  onLoad?: (event: WebViewNavigationEvent) => void;\n  onLoadEnd?: (event: WebViewNavigationEvent | WebViewErrorEvent) => void;\n  onLoadStart?: (event: WebViewNavigationEvent) => void;\n  onLoadProgress?: (event: WebViewProgressEvent) => void;\n  onHttpError?: (event: WebViewHttpErrorEvent) => void;\n  onMessage?: (event: WebViewMessageEvent) => void;\n  onNavigationStateChange?: (event: WebViewNavigation) => void;\n  onScroll?: (event: WebViewScrollEvent) => void;\n  onContentProcessDidTerminate?: (event: WebViewTerminatedEvent) => void;\n  onShouldStartLoadWithRequest?: (event: ShouldStartLoadRequest) => boolean;\n  originWhitelist?: string[];\n  renderLoading?: () => ReactElement;\n  renderError?: (\n    errorDomain: string | undefined,\n    errorCode: number,\n    errorDesc: string\n  ) => ReactElement; // view to show if there's an error\n  containerStyle?: ViewStyle;\n}\n\nconst NativeWebView: React.FC<WebViewProps> = ({\n  source,\n  style,\n  optimizeVideoChat,\n  ...otherWebViewProps\n}) => {\n  const [height, setHeight] = useState(0);\n\n  const [cameraPermissions, setCameraPermissions] =\n    useState<null | PermissionResponse>(null);\n\n  const [microphonePermissions, setMicrophonePermissions] =\n    useState<null | PermissionResponse>(null);\n\n  const videoChatProps = optimizeVideoChat\n    ? {\n        allowsInlineMediaPlayback: true,\n        domStorageEnabled: true,\n        javaScriptEnabled: true,\n        mediaCapturePermissionGrantType: \"grant\", // so iOS uses system settings\n        mediaPlaybackRequiresUserAction: false,\n        startInLoadingState: true,\n      }\n    : ({} as Record<string, boolean | string>);\n\n  const onMessage = (event: WebViewMessageEvent) =>\n    setHeight(Number(event.nativeEvent.data));\n\n  const getAndSetPermissions = async (\n    currentState: null | PermissionResponse,\n    setCurrentState: Dispatch<SetStateAction<null | PermissionResponse>>,\n    getPermission: () => Promise<PermissionResponse>,\n    requestPermission: () => Promise<PermissionResponse>\n  ) => {\n    const currentPermission = currentState ?? (await getPermission());\n\n    if (currentPermission.granted || !currentPermission.canAskAgain) {\n      setCurrentState(currentPermission);\n    } else {\n      setCurrentState(await requestPermission());\n    }\n  };\n\n  const getAndSetCameraAndMicrophonePermissions = async () => {\n    await getAndSetPermissions(\n      cameraPermissions,\n      setCameraPermissions,\n      Camera.getCameraPermissionsAsync,\n      Camera.requestCameraPermissionsAsync\n    );\n\n    await getAndSetPermissions(\n      microphonePermissions,\n      setMicrophonePermissions,\n      Camera.getMicrophonePermissionsAsync,\n      Camera.requestMicrophonePermissionsAsync\n    );\n  };\n\n  const getFinalWidth = () => {\n    const { width } = Dimensions.get(\"window\");\n\n    if (typeof style?.width === \"number\") {\n      return style.width;\n    } else if (typeof style?.width === \"string\" && style.width.includes(\"%\")) {\n      return width * (Number(style.width.replace(\"%\", \"\")) / 100);\n    } else {\n      return width;\n    }\n  };\n\n  const selectComponent = () => {\n    if (\n      !optimizeVideoChat ||\n      (cameraPermissions?.granted && microphonePermissions?.granted)\n    ) {\n      return (\n        <WebView\n          source={source}\n          style={{ ...style, width: getFinalWidth() }}\n          injectedJavaScript={injectFirst}\n          onMessage={onMessage}\n          {...otherWebViewProps}\n          {...videoChatProps}\n        />\n      );\n    }\n\n    if (\n      (!cameraPermissions?.granted && cameraPermissions?.canAskAgain) ||\n      (!microphonePermissions?.granted && microphonePermissions?.canAskAgain)\n    ) {\n      return (\n        <Button\n          title={\"Press to enable Audio and/or Video permissions\"}\n          onPress={getAndSetCameraAndMicrophonePermissions}\n        />\n      );\n    }\n\n    if (\n      (cameraPermissions?.status === \"denied\" &&\n        cameraPermissions?.canAskAgain === false) ||\n      (microphonePermissions?.status === \"denied\" &&\n        microphonePermissions?.canAskAgain === false)\n    ) {\n      return (\n        <Text>\n          {\"Set the missing Audio and/or Video permissions in System Settings\"}\n        </Text>\n      );\n    }\n\n    return <ActivityIndicator />;\n  };\n\n  useEffect(() => {\n    if (optimizeVideoChat) getAndSetCameraAndMicrophonePermissions();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [optimizeVideoChat]);\n\n  return (\n    <ScrollView\n      contentContainerStyle={[\n        styles.container,\n        {\n          height: style?.height || height,\n        },\n      ]}\n    >\n      {selectComponent()}\n    </ScrollView>\n  );\n};\n\nconst BrowserWebView: React.FC<WebViewProps> = ({\n  source,\n  style,\n  optimizeVideoChat,\n}) => {\n  const videoChatProps = optimizeVideoChat\n    ? {\n        frameBorder: \"0\",\n        allow: \"camera; microphone; fullscreen; speaker; display-capture\",\n      }\n    : {};\n\n  const videoChatStyles = optimizeVideoChat\n    ? { width: \"100%\", height: \"100%\" }\n    : {};\n\n  const flatStyles = StyleSheet.flatten([videoChatStyles, style]);\n  return React.createElement(\"iframe\", {\n    style: flatStyles,\n    height: flatStyles?.height,\n    width: flatStyles?.width,\n    src: (source as WebViewSourceUri)?.uri,\n    srcDoc: (source as WebViewSourceHtml)?.html,\n    allowFullScreen: true,\n    seamless: true,\n    ...videoChatProps,\n  });\n};\n\nexport default Platform.select({\n  native: NativeWebView,\n  default: BrowserWebView,\n});\n\nconst styles = StyleSheet.create({\n  container: {\n    flexGrow: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n});\n"],"mappings":"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"}